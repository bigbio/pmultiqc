<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMultiQC - Proteomics MultiQC Analysis</title>
    <link rel="stylesheet" href="{{ config.BASE_URL.rstrip('/') }}/static/style.css">
    <link rel="stylesheet" href="{{ config.BASE_URL.rstrip('/') }}/static/components.css">
    <script>
        // Global configuration - can be overridden by environment
        window.APP_CONFIG = {
            BASE_URL: '{{ config.BASE_URL.rstrip("/") }}',
            API_BASE: '{{ config.BASE_URL.rstrip("/") }}'
        };
    
        // Normalize and build API URL safely
        function getApiUrl(endpoint) {
            const base = String(window.APP_CONFIG.API_BASE || '').replace(/\/+$/, '');
            const path = String(endpoint || '').replace(/^\/+/, '');
            return `${base}/${path}`;
        }
        
        // Function to get full URL for static assets
        function getAssetUrl(asset) {
            return `${window.APP_CONFIG.BASE_URL}/static/${asset}`;
        }
        
        // Define hideLoading function early to avoid reference errors
        function hideLoading() {
            const loading = document.getElementById('reportLoading');
            const iframe = document.getElementById('reportIframe');
            if (loading && iframe) {
                loading.style.display = 'none';
                iframe.style.display = 'block';
            }
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="logo">PMultiQC</div>
        <div class="subtitle">Proteomics MultiQC Analysis</div>

        <!-- Step 1: Choose Analysis Type -->
        <div id="step1" class="step active">
            <h3>üîç Choose Analysis Type</h3>
            <p>Select how you want to analyze your proteomics data</p>
            <button class="upload-btn" onclick="showStep('upload')">üìÅ Upload Files</button>
            <button class="upload-btn" onclick="showStep('pride')">üîç PRIDE Dataset</button>
        </div>

        <!-- Step 2: File Upload -->
        <div id="step2-upload" class="step">
            <h3>üìÅ Upload Files</h3>
            <p>Upload your proteomics data files as ZIP archives (containing MaxQuant, DIANN, quantms, or mzIdentML data)</p>
            <input type="file" id="fileInput" class="file-input" multiple accept=".zip">
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">Choose Files</button>
            <div id="fileList"></div>
            <button class="return-home-btn" onclick="returnToHome()">‚Üê Back to Home</button>
        </div>

        <!-- Step 3: PRIDE Dataset -->
        <div id="step2-pride" class="step">
            <h3>üîç PRIDE Dataset Analysis</h3>
            <p>Analyze public PRIDE datasets by entering the accession number</p>
            <input type="text" id="prideAccession" class="pride-input" placeholder="Enter PRIDE accession (e.g., PXD003133)" maxlength="20">
            <div style="text-align: center; margin-top: 8px;">
                <a href="#" onclick="showExamples()" style="color: #007bff; text-decoration: none; font-size: 14px;">View Examples</a>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="process-btn" onclick="processPrideDataset()">Process PRIDE Dataset</button>
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <button class="return-home-btn" onclick="returnToHome()">‚Üê Back to Home</button>
            </div>
        </div>

        <!-- Step 4: Progress -->
        <div id="step5" class="step">
            <h3 id="progressTitle">‚è≥ Processing...</h3>
            
            <!-- Upload Progress Section -->
            <div id="uploadProgressSection" style="margin-bottom: 20px;">
                <h4 style="color: #495057; margin-bottom: 10px;">üìÅ File Upload</h4>
                <div id="progressContainer" class="progress-container">
                    <div class="progress-bar">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>
                    <div id="progressText" class="progress-text">Starting processing...</div>
                    <button id="cancelUploadBtn" class="return-home-btn" style="display: none; margin-top: 15px;" onclick="cancelUpload()">‚ùå Cancel Upload</button>
                </div>
            </div>
            
            <!-- Processing Progress Section -->
            <div id="processingProgressSection" style="display: none; margin-bottom: 20px;">
                <h4 style="color: #495057; margin-bottom: 10px;">‚öôÔ∏è PMultiQC Analysis</h4>
                <div class="progress-container">
                    <div class="progress-bar">
                        <div id="processingProgressFill" class="progress-fill" style="background: linear-gradient(45deg, #28a745, #20c997);"></div>
                    </div>
                    <div id="processingProgressText" class="progress-text">Starting pmultiqc analysis...</div>
                </div>
            </div>
            
            <!-- Console Output Section -->
            <div id="consoleOutputSection" style="display: none;">
                <h4 style="color: #495057; margin-bottom: 10px;">üìã Console Output</h4>
                <div id="consoleOutput" style="
                    background: #f8f9fa; 
                    border: 1px solid #e9ecef; 
                    border-radius: 8px; 
                    padding: 15px; 
                    font-family: 'Courier New', monospace; 
                    font-size: 12px; 
                    max-height: 300px; 
                    overflow-y: auto; 
                    white-space: pre-wrap; 
                    color: #333;
                    line-height: 1.4;
                "></div>
            </div>
        </div>

        <!-- Results -->
        <div id="result" class="result"></div>

        <!-- pmultiqc Information Footer -->
        <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); margin-top: 40px; padding: 30px; border-top: 3px solid #007bff; border-radius: 0 0 15px 15px; width: 100%; max-width: 800px; margin-left: auto; margin-right: auto;">
            <div style="text-align: center;">
            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.5em;">About PMultiQC</h3>
            <p style="color: #666; line-height: 1.6; margin-bottom: 25px; font-size: 1.1em;">
                <strong>pmultiqc</strong> is a MultiQC plugin for comprehensive quality control reporting of proteomics data. 
                It generates interactive HTML reports with visualizations and metrics to help you assess the quality of 
                your mass spectrometry-based proteomics experiments.
            </p>
            
            <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; margin-bottom: 20px;">
                <a href="https://pmultiqc.quantms.org" target="_blank" style="
                    display: inline-block; 
                    padding: 12px 25px; 
                    background: linear-gradient(45deg, #007bff, #0056b3); 
                    color: white; 
                    text-decoration: none; 
                    border-radius: 8px; 
                    font-weight: bold; 
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(0,123,255,0.3)'" 
                   onmouseout="this.style.transform='none'; this.style.boxShadow='none'">
                    üåê Project Website
                </a>
                
                <a href="https://github.com/bigbio/pmultiqc" target="_blank" style="
                    display: inline-block; 
                    padding: 12px 25px; 
                    background: linear-gradient(45deg, #28a745, #20c997); 
                    color: white; 
                    text-decoration: none; 
                    border-radius: 8px; 
                    font-weight: bold; 
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(40,167,69,0.3)'" 
                   onmouseout="this.style.transform='none'; this.style.boxShadow='none'">
                    üìÇ GitHub Repository
                </a>
                
                <a href="https://pmultiqc.quantms.org/#-example-reports" target="_blank" style="
                    display: inline-block; 
                    padding: 12px 25px; 
                    background: linear-gradient(45deg, #6f42c1, #5a32a3); 
                    color: white; 
                    text-decoration: none; 
                    border-radius: 8px; 
                    font-weight: bold; 
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(111,66,193,0.3)'" 
                   onmouseout="this.style.transform='none'; this.style.boxShadow='none'">
                    üìä Example Reports
                </a>
            </div>
            
            <div style="border-top: 1px solid #dee2e6; padding-top: 20px;">
                <p style="color: #6c757d; font-size: 0.9em; margin: 0;">
                    Powered by <strong>PMultiQC</strong> - A comprehensive proteomics quality control framework
                </p>
            </div>
        </div>
    </div>

    <script>
        let currentJobId = null;
        let processingInProgress = false;
        let currentUploadXhr = null;

        // Wizard navigation
        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            
            // Show selected step
            if (step === 'upload') {
                document.getElementById('step2-upload').classList.add('active');
            } else if (step === 'pride') {
                document.getElementById('step2-pride').classList.add('active');
            }
        }

        function showProgress() {
            processingInProgress = true;
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step5').classList.add('active');
            document.getElementById('progressContainer').style.display = 'block';
        }

        function returnToHome() {
            processingInProgress = false;
            currentJobId = null;
            currentUploadXhr = null;
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
            document.getElementById('result').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('cancelUploadBtn').style.display = 'none';
            
            // Reset progress sections
            document.getElementById('processingProgressSection').style.display = 'none';
            document.getElementById('consoleOutputSection').style.display = 'none';
            document.getElementById('progressTitle').textContent = '‚è≥ Processing...';
            document.getElementById('consoleOutput').innerHTML = '';
            
            // Reset progress bars
            document.getElementById('progressFill').style.width = '0%';
            document.getElementById('processingProgressFill').style.width = '0%';
            
            // Reset form fields
            document.getElementById('fileInput').value = '';
            document.getElementById('prideAccession').value = '';
            document.getElementById('fileList').innerHTML = '';
        }

        function cancelUpload() {
            if (currentUploadXhr) {
                currentUploadXhr.abort();
                currentUploadXhr = null;
            }
            processingInProgress = false;
            document.getElementById('cancelUploadBtn').style.display = 'none';
            showError('Upload cancelled by user');
        }

        // File upload functionality
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const files = e.target.files;
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = '';
            
            for (let file of files) {
                const div = document.createElement('div');
                div.textContent = file.name;
                div.style.margin = '5px 0';
                div.style.padding = '5px';
                div.style.background = '#e9ecef';
                div.style.borderRadius = '4px';
                fileList.appendChild(div);
            }
            
            if (files.length > 0) {
                uploadFiles(files);
            }
        });

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatSpeed(bytesPerSecond) {
            return formatBytes(bytesPerSecond) + '/s';
        }

        function formatTime(seconds) {
            if (!isFinite(seconds) || isNaN(seconds) || seconds <= 0) return 'calculating...';
            if (seconds < 60) return Math.round(seconds) + 's';
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.round(seconds % 60);
            return minutes + 'm ' + remainingSeconds + 's';
        }

        function uploadFiles(files) {
            if (processingInProgress) return;
            
            console.log('Starting file upload with', files.length, 'files');
            
            const formData = new FormData();
            let totalSize = 0;
            for (let file of files) {
                formData.append('files', file);
                totalSize += file.size;
                console.log('Added file to form data:', file.name, formatBytes(file.size));
            }

            showProgress();
            
            // Initialize progress display
            const progressText = document.getElementById('progressText');
            const progressFill = document.getElementById('progressFill');
            
            progressText.innerHTML = `Preparing to upload ${formatBytes(totalSize)}...`;
            progressFill.style.width = '0%';

            // Track upload timing
            const startTime = Date.now();
            
            // Use XMLHttpRequest for upload progress tracking
            const xhr = new XMLHttpRequest();
            currentUploadXhr = xhr; // Store for potential cancellation
            
            // Show cancel button
            document.getElementById('cancelUploadBtn').style.display = 'inline-block';
            
            // Track upload progress
            xhr.upload.addEventListener('progress', function(e) {
                if (e.lengthComputable) {
                    const percentComplete = (e.loaded / e.total) * 100;
                    const elapsed = (Date.now() - startTime) / 1000; // seconds
                    const uploadedMB = e.loaded;
                    const totalMB = e.total;
                    
                    // Update progress bar
                    progressFill.style.width = percentComplete + '%';
                    
                    // Calculate speed and ETA (only if enough time has elapsed)
                    let speedText = 'calculating...';
                    let etaText = 'calculating...';
                    
                    if (elapsed > 0.5 && uploadedMB > 0) { // Wait at least 500ms for stable calculation
                        const speed = uploadedMB / elapsed; // bytes per second
                        const remaining = e.total - e.loaded;
                        const eta = remaining / speed; // seconds
                        
                        speedText = formatSpeed(speed);
                        etaText = formatTime(eta);
                    }
                    
                    // Update progress text with detailed info
                    progressText.innerHTML = `
                        <div>Uploading: ${percentComplete.toFixed(1)}% complete</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">
                            ${formatBytes(uploadedMB)} / ${formatBytes(totalMB)} ‚Ä¢ 
                            ${speedText} ‚Ä¢ 
                            ETA: ${etaText}
                        </div>
                    `;
                    
                    console.log(`Upload progress: ${percentComplete.toFixed(1)}% (${formatBytes(uploadedMB)}/${formatBytes(totalMB)})`);
                }
            });
            
            // Handle upload completion
            xhr.addEventListener('load', function() {
                // Hide cancel button and clear xhr reference
                document.getElementById('cancelUploadBtn').style.display = 'none';
                currentUploadXhr = null;
                
                if (xhr.status >= 200 && xhr.status < 300) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        console.log('Upload response data:', data);
                        
                        if (data.job_id) {
                            currentJobId = data.job_id;
                            const uploadTime = (Date.now() - startTime) / 1000;
                            
                            // Update upload section to show completion
                            progressText.innerHTML = `
                                <div>‚úÖ Upload completed in ${formatTime(uploadTime)}</div>
                                <div style="font-size: 0.8em; margin-top: 5px; color: #28a745;">
                                    ${formatBytes(totalSize)} uploaded successfully
                                </div>
                            `;
                            progressFill.style.width = '100%';
                            
                            // Show processing section
                            document.getElementById('processingProgressSection').style.display = 'block';
                            document.getElementById('consoleOutputSection').style.display = 'block';
                            
                            // Update title
                            document.getElementById('progressTitle').textContent = '‚öôÔ∏è Running PMultiQC Analysis...';
                            
                            // Start polling for processing status
                            setTimeout(() => {
                                pollStatus(data.job_id);
                            }, 1000);
                        } else {
                            showError(data.error || 'Upload failed');
                        }
                    } catch (e) {
                        console.error('Error parsing response:', e);
                        showError('Upload failed: Invalid server response');
                    }
                } else {
                    console.error('Upload failed with status:', xhr.status);
                    try {
                        const errorData = JSON.parse(xhr.responseText);
                        showError('Upload failed: ' + (errorData.error || xhr.statusText));
                    } catch (e) {
                        showError('Upload failed: ' + xhr.statusText);
                    }
                }
            });
            
            // Handle upload errors
            xhr.addEventListener('error', function() {
                // Hide cancel button and clear xhr reference
                document.getElementById('cancelUploadBtn').style.display = 'none';
                currentUploadXhr = null;
                console.error('Upload error occurred');
                showError('Upload failed: Network error');
            });
            
            // Handle upload abort
            xhr.addEventListener('abort', function() {
                // Hide cancel button and clear xhr reference
                document.getElementById('cancelUploadBtn').style.display = 'none';
                currentUploadXhr = null;
                console.log('Upload aborted');
                showError('Upload was cancelled');
            });
            
            // Start the upload
            xhr.open('POST', getApiUrl('/upload-async'));
            xhr.send(formData);
        }

        // PRIDE dataset processing
        function processPrideDataset() {
            const accession = document.getElementById('prideAccession').value.trim().toUpperCase();
            
            if (!accession) {
                showError('Please enter a PRIDE accession number');
                return;
            }
            
            if (!accession.startsWith('PXD')) {
                showError('Invalid PRIDE accession format. Should start with PXD');
                return;
            }

            // Redirect to submit page with the accession
            window.location.href = `${window.APP_CONFIG.BASE_URL}/submit?accession=${accession}`;
        }

        // Poll status for file uploads
        function pollStatus(jobId) {
            let lastConsoleOutputLength = 0;
            let lastConsoleErrorsLength = 0;
            
            const interval = setInterval(() => {
                if (!processingInProgress) {
                    clearInterval(interval);
                    return;
                }
                
                fetch(getApiUrl(`/job-status/${jobId}`))
                .then(response => {
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    console.log('Polling response for job', jobId, ':', data);
                    console.log('Job status:', data.status);
                    console.log('Processing in progress:', processingInProgress);
                    
                    // Update processing progress
                    if (data.progress !== undefined) {
                        const processingProgressFill = document.getElementById('processingProgressFill');
                        const processingProgressText = document.getElementById('processingProgressText');
                        
                        if (processingProgressFill && processingProgressText) {
                            processingProgressFill.style.width = data.progress + '%';
                            
                            let statusText = `Processing... ${data.progress}%`;
                            if (data.processing_stage) {
                                statusText = `${data.processing_stage} (${data.progress}%)`;
                            }
                            processingProgressText.textContent = statusText;
                        }
                    }
                    
                    // Update console output in real-time
                    updateConsoleOutput(data.console_output || [], data.console_errors || [], lastConsoleOutputLength, lastConsoleErrorsLength);
                    
                    // Update last lengths
                    lastConsoleOutputLength = (data.console_output || []).length;
                    lastConsoleErrorsLength = (data.console_errors || []).length;
                    
                    if (data.status === 'completed' || data.status === 'failed') {
                        clearInterval(interval);
                        processingInProgress = false;
                        
                        console.log('Job completed or failed. Status:', data.status);
                        console.log('Calling displayResults with jobId:', jobId);
                        console.log('About to call displayResults function...');
                        
                        // Update title for completion
                        if (data.status === 'completed') {
                            document.getElementById('progressTitle').textContent = '‚úÖ Analysis Complete!';
                        } else {
                            document.getElementById('progressTitle').textContent = '‚ùå Analysis Failed';
                        }
                        
                        console.log('Calling displayResults now...');
                        displayResults(data, jobId);
                        console.log('displayResults called successfully');
                    }
                })
                .catch(error => {
                    console.error('Error polling job status:', error);
                    // Don't immediately show error and return to home for temporary network issues
                    // Only clear interval and stop polling, but don't call showError
                    clearInterval(interval);
                    processingInProgress = false;
                    
                    // Log the error but don't redirect to home
                    console.log('Polling failed, but job might still be running. Error:', error.message);
                });
            }, 1000);
        }
        
        function updateConsoleOutput(consoleOutput, consoleErrors, lastOutputLength, lastErrorsLength) {
            const consoleDiv = document.getElementById('consoleOutput');
            if (!consoleDiv) return;
            
            // Add new output lines
            const newOutputLines = consoleOutput.slice(lastOutputLength);
            const newErrorLines = consoleErrors.slice(lastErrorsLength);
            
            // Append new output lines
            newOutputLines.forEach(line => {
                if (line.trim()) {
                    const lineDiv = document.createElement('div');
                    lineDiv.style.margin = '2px 0';
                    lineDiv.style.color = '#2e8b57'; // Green for output
                    lineDiv.textContent = '> ' + line;
                    consoleDiv.appendChild(lineDiv);
                }
            });
            
            // Append new error lines
            newErrorLines.forEach(line => {
                if (line.trim()) {
                    const lineDiv = document.createElement('div');
                    lineDiv.style.margin = '2px 0';
                    lineDiv.style.color = '#dc3545'; // Red for errors
                    lineDiv.style.fontWeight = 'bold';
                    lineDiv.textContent = '! ' + line;
                    consoleDiv.appendChild(lineDiv);
                }
            });
            
            // Auto-scroll to bottom if there's new content
            if (newOutputLines.length > 0 || newErrorLines.length > 0) {
                consoleDiv.scrollTop = consoleDiv.scrollHeight;
            }
            
            // Show some initial text if console is empty
            if (consoleDiv.children.length === 0) {
                const placeholderDiv = document.createElement('div');
                placeholderDiv.style.color = '#6c757d';
                placeholderDiv.style.fontStyle = 'italic';
                placeholderDiv.textContent = 'Waiting for pmultiqc output...';
                consoleDiv.appendChild(placeholderDiv);
            }
        }



        // Display results
        function displayResults(data, jobId) {
            console.log('=== DISPLAY RESULTS FUNCTION CALLED ===');
            console.log('displayResults called with data:', data);
            console.log('displayResults - console_output:', data.console_output);
            console.log('displayResults - console_errors:', data.console_errors);
            console.log('displayResults - html_report_urls:', data.html_report_urls);
            console.log('displayResults - results:', data.results);
            console.log('Job ID for redirect:', jobId);
            console.log('Base URL:', window.APP_CONFIG.BASE_URL);
            
            const redirectUrl = `${window.APP_CONFIG.BASE_URL}/results/${jobId}?t=${Date.now()}`;
            console.log('Redirecting to:', redirectUrl);
            console.log('Current location:', window.location.href);
            
            // Redirect to the results page instead of showing results inline
            try {
                console.log('Attempting redirect with window.location.replace...');
                window.location.replace(redirectUrl);
                console.log('Redirect command executed');
                
                // Add a timeout as backup in case the redirect doesn't work
                setTimeout(() => {
                    console.log('Backup redirect attempt...');
                    if (window.location.href !== redirectUrl) {
                        console.log('Redirect failed, trying window.location.assign...');
                        window.location.assign(redirectUrl);
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Error during redirect:', error);
                // Fallback: try using window.location.href
                console.log('Trying fallback redirect with window.location.href...');
                window.location.href = redirectUrl;
            }
        }

        // Helper functions
        function showError(message) {
            processingInProgress = false;
            currentUploadXhr = null;
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result error';
            resultDiv.innerHTML = `<h4>‚ùå Error</h4><p>${message}</p><button class="return-home-btn" onclick="returnToHome()">‚Üê Return to Home</button>`;
            resultDiv.style.display = 'block';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('cancelUploadBtn').style.display = 'none';
            
            // Hide processing sections
            document.getElementById('processingProgressSection').style.display = 'none';
            document.getElementById('consoleOutputSection').style.display = 'none';
            
            // Update title
            document.getElementById('progressTitle').textContent = '‚ùå Error Occurred';
        }

        // Examples Modal
        function showExamples() {
            const modal = document.getElementById('examplesModal');
            modal.style.display = 'block';
        }

        function closeExamples() {
            const modal = document.getElementById('examplesModal');
            modal.style.display = 'none';
        }

        function selectExample(accession) {
            document.getElementById('prideAccession').value = accession;
            closeExamples();
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('examplesModal');
            if (event.target === modal) {
                closeExamples();
            }
        }
    </script>

    <!-- Examples Modal -->
    <div id="examplesModal" class="modal" style="
        display: none; 
        position: fixed; 
        z-index: 1000; 
        left: 0; 
        top: 0; 
        width: 100%; 
        height: 100%; 
        background-color: rgba(0,0,0,0.5);
    ">
        <div class="modal-content" style="
            background-color: #fefefe; 
            margin: 5% auto; 
            padding: 20px; 
            border: 1px solid #888; 
            width: 80%; 
            max-width: 600px; 
            border-radius: 10px;
            position: relative;
        ">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; color: #333;">üìã PRIDE Dataset Examples</h3>
                <span onclick="closeExamples()" style="
                    color: #aaa; 
                    font-size: 28px; 
                    font-weight: bold; 
                    cursor: pointer;
                ">&times;</span>
            </div>
            
            <div style="margin-bottom: 20px;">
                <p style="color: #666; margin-bottom: 15px;">
                    Here are some example PRIDE datasets you can analyze. Click on any example to automatically fill the accession field.
                </p>
            </div>

            <div style="display: grid; gap: 15px;">
                <!-- MaxQuant Example -->
                <div style="
                    border: 1px solid #e9ecef; 
                    border-radius: 8px; 
                    padding: 15px; 
                    background: #f8f9fa;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: #333;">PXD003133 - MaxQuant Analysis</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">
                                A comprehensive MaxQuant analysis dataset with evidence.txt, peptides.txt, and proteinGroups.txt files.
                                This dataset demonstrates typical MaxQuant output structure and quality metrics.
                            </p>
                        </div>
                        <button onclick="selectExample('PXD003133')" style="
                            background: linear-gradient(45deg, #007bff, #0056b3); 
                            color: white; 
                            border: none; 
                            padding: 8px 16px; 
                            border-radius: 6px; 
                            cursor: pointer; 
                            font-size: 12px;
                        ">Use This Example</button>
                    </div>
                </div>

                <!-- DIANN Example -->
                <div style="
                    border: 1px solid #e9ecef; 
                    border-radius: 8px; 
                    padding: 15px; 
                    background: #f8f9fa;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: #333;">PXD061709 - DIANN Analysis</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">
                                A DIANN search engine analysis dataset with report.tsv files. This dataset shows 
                                DIANN's output format and provides insights into peptide identification quality.
                            </p>
                        </div>
                        <button onclick="selectExample('PXD061709')" style="
                            background: linear-gradient(45deg, #28a745, #20c997); 
                            color: white; 
                            border: none; 
                            padding: 8px 16px; 
                            border-radius: 6px; 
                            cursor: pointer; 
                            font-size: 12px;
                        ">Use This Example</button>
                    </div>
                </div>

                <!-- DIANN Example 2 -->
                <div style="
                    border: 1px solid #e9ecef; 
                    border-radius: 8px; 
                    padding: 15px; 
                    background: #f8f9fa;
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: #333;">PXD039477 - DIANN Analysis</h4>
                            <p style="margin: 0; color: #666; font-size: 14px;">
                                Another DIANN search engine analysis dataset with comprehensive proteomics data. 
                                This dataset provides additional examples of DIANN output format and analysis results.
                            </p>
                        </div>
                        <button onclick="selectExample('PXD039477')" style="
                            background: linear-gradient(45deg, #6f42c1, #5a32a3); 
                            color: white; 
                            border: none; 
                            padding: 8px 16px; 
                            border-radius: 6px; 
                            cursor: pointer; 
                            font-size: 12px;
                        ">Use This Example</button>
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <button onclick="closeExamples()" style="
                    background: #6c757d; 
                    color: white; 
                    border: none; 
                    padding: 10px 20px; 
                    border-radius: 6px; 
                    cursor: pointer;
                ">Close</button>
            </div>
        </div>
    </div>
</body>
</html> 